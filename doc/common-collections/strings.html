<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用字符串存储 UTF-8 编码的文本 | rust语言中文文档</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/rust-doc/logo.svg">
    <script type="text/javascript" src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>
    <meta name="description" content="一门赋予每个人构建可靠且高效软件能力的语言。">
    
    <link rel="preload" href="/rust-doc/assets/css/0.styles.b04b0b2c.css" as="style"><link rel="preload" href="/rust-doc/assets/js/app.5c13fa7e.js" as="script"><link rel="preload" href="/rust-doc/assets/js/2.de3bffe6.js" as="script"><link rel="preload" href="/rust-doc/assets/js/1.5cc4c8d6.js" as="script"><link rel="preload" href="/rust-doc/assets/js/61.177a1122.js" as="script"><link rel="prefetch" href="/rust-doc/assets/js/10.eb17c9b1.js"><link rel="prefetch" href="/rust-doc/assets/js/100.4472ced5.js"><link rel="prefetch" href="/rust-doc/assets/js/101.6f557fbb.js"><link rel="prefetch" href="/rust-doc/assets/js/102.9daa86b5.js"><link rel="prefetch" href="/rust-doc/assets/js/103.bcaeaf61.js"><link rel="prefetch" href="/rust-doc/assets/js/104.298be94b.js"><link rel="prefetch" href="/rust-doc/assets/js/105.b68314ce.js"><link rel="prefetch" href="/rust-doc/assets/js/106.cfe11391.js"><link rel="prefetch" href="/rust-doc/assets/js/107.2d552198.js"><link rel="prefetch" href="/rust-doc/assets/js/108.7fec27ae.js"><link rel="prefetch" href="/rust-doc/assets/js/109.82f76077.js"><link rel="prefetch" href="/rust-doc/assets/js/11.4d96857f.js"><link rel="prefetch" href="/rust-doc/assets/js/110.a53e3e27.js"><link rel="prefetch" href="/rust-doc/assets/js/111.1f6f54d4.js"><link rel="prefetch" href="/rust-doc/assets/js/112.51686911.js"><link rel="prefetch" href="/rust-doc/assets/js/113.4c27aaab.js"><link rel="prefetch" href="/rust-doc/assets/js/114.c5362d12.js"><link rel="prefetch" href="/rust-doc/assets/js/115.85ecb498.js"><link rel="prefetch" href="/rust-doc/assets/js/116.868fd500.js"><link rel="prefetch" href="/rust-doc/assets/js/117.03c6f7e5.js"><link rel="prefetch" href="/rust-doc/assets/js/118.239c184e.js"><link rel="prefetch" href="/rust-doc/assets/js/119.1ee2edb3.js"><link rel="prefetch" href="/rust-doc/assets/js/12.0eea138a.js"><link rel="prefetch" href="/rust-doc/assets/js/120.614fc57c.js"><link rel="prefetch" href="/rust-doc/assets/js/121.09c2f1e5.js"><link rel="prefetch" href="/rust-doc/assets/js/122.ed79b9ef.js"><link rel="prefetch" href="/rust-doc/assets/js/123.44c45225.js"><link rel="prefetch" href="/rust-doc/assets/js/124.be91d234.js"><link rel="prefetch" href="/rust-doc/assets/js/125.f60d3132.js"><link rel="prefetch" href="/rust-doc/assets/js/13.da6262af.js"><link rel="prefetch" href="/rust-doc/assets/js/14.9386ae96.js"><link rel="prefetch" href="/rust-doc/assets/js/15.c72c8a9e.js"><link rel="prefetch" href="/rust-doc/assets/js/16.1c185a04.js"><link rel="prefetch" href="/rust-doc/assets/js/17.a6413d33.js"><link rel="prefetch" href="/rust-doc/assets/js/18.d85b922c.js"><link rel="prefetch" href="/rust-doc/assets/js/19.ac65ddaa.js"><link rel="prefetch" href="/rust-doc/assets/js/20.b2f37783.js"><link rel="prefetch" href="/rust-doc/assets/js/21.bc7abb0d.js"><link rel="prefetch" href="/rust-doc/assets/js/22.b15740d1.js"><link rel="prefetch" href="/rust-doc/assets/js/23.5216c752.js"><link rel="prefetch" href="/rust-doc/assets/js/24.3123e7b2.js"><link rel="prefetch" href="/rust-doc/assets/js/25.ffa67e3b.js"><link rel="prefetch" href="/rust-doc/assets/js/26.7cf20f6f.js"><link rel="prefetch" href="/rust-doc/assets/js/27.b6484f43.js"><link rel="prefetch" href="/rust-doc/assets/js/28.0f13f9fb.js"><link rel="prefetch" href="/rust-doc/assets/js/29.7b185968.js"><link rel="prefetch" href="/rust-doc/assets/js/3.bfcba754.js"><link rel="prefetch" href="/rust-doc/assets/js/30.2a560a0c.js"><link rel="prefetch" href="/rust-doc/assets/js/31.4f52eb6e.js"><link rel="prefetch" href="/rust-doc/assets/js/32.fc2b799e.js"><link rel="prefetch" href="/rust-doc/assets/js/33.53e7f224.js"><link rel="prefetch" href="/rust-doc/assets/js/34.2e88be93.js"><link rel="prefetch" href="/rust-doc/assets/js/35.bc9b7f0e.js"><link rel="prefetch" href="/rust-doc/assets/js/36.bbd4a5bc.js"><link rel="prefetch" href="/rust-doc/assets/js/37.be3ca43f.js"><link rel="prefetch" href="/rust-doc/assets/js/38.0568c49e.js"><link rel="prefetch" href="/rust-doc/assets/js/39.b117bfab.js"><link rel="prefetch" href="/rust-doc/assets/js/4.508a9818.js"><link rel="prefetch" href="/rust-doc/assets/js/40.f1cdd9db.js"><link rel="prefetch" href="/rust-doc/assets/js/41.22870d1e.js"><link rel="prefetch" href="/rust-doc/assets/js/42.2e6896bc.js"><link rel="prefetch" href="/rust-doc/assets/js/43.76536417.js"><link rel="prefetch" href="/rust-doc/assets/js/44.8eec254b.js"><link rel="prefetch" href="/rust-doc/assets/js/45.e2eabd53.js"><link rel="prefetch" href="/rust-doc/assets/js/46.e639ca36.js"><link rel="prefetch" href="/rust-doc/assets/js/47.f40c46d3.js"><link rel="prefetch" href="/rust-doc/assets/js/48.292e07e1.js"><link rel="prefetch" href="/rust-doc/assets/js/49.49879441.js"><link rel="prefetch" href="/rust-doc/assets/js/5.f95f0a29.js"><link rel="prefetch" href="/rust-doc/assets/js/50.cab0465e.js"><link rel="prefetch" href="/rust-doc/assets/js/51.275c138c.js"><link rel="prefetch" href="/rust-doc/assets/js/52.66bf1683.js"><link rel="prefetch" href="/rust-doc/assets/js/53.cdd0deae.js"><link rel="prefetch" href="/rust-doc/assets/js/54.dad0b4b3.js"><link rel="prefetch" href="/rust-doc/assets/js/55.aef9e354.js"><link rel="prefetch" href="/rust-doc/assets/js/56.bd29ab4d.js"><link rel="prefetch" href="/rust-doc/assets/js/57.e88ca182.js"><link rel="prefetch" href="/rust-doc/assets/js/58.1f893a7a.js"><link rel="prefetch" href="/rust-doc/assets/js/59.97397921.js"><link rel="prefetch" href="/rust-doc/assets/js/6.c4bf9bde.js"><link rel="prefetch" href="/rust-doc/assets/js/60.d19f7f8c.js"><link rel="prefetch" href="/rust-doc/assets/js/62.8cb2c3e5.js"><link rel="prefetch" href="/rust-doc/assets/js/63.25973381.js"><link rel="prefetch" href="/rust-doc/assets/js/64.92747d7d.js"><link rel="prefetch" href="/rust-doc/assets/js/65.8540fa6d.js"><link rel="prefetch" href="/rust-doc/assets/js/66.f6ed2124.js"><link rel="prefetch" href="/rust-doc/assets/js/67.63f142fc.js"><link rel="prefetch" href="/rust-doc/assets/js/68.d028c7f9.js"><link rel="prefetch" href="/rust-doc/assets/js/69.0490e8c4.js"><link rel="prefetch" href="/rust-doc/assets/js/7.7610c249.js"><link rel="prefetch" href="/rust-doc/assets/js/70.b918698c.js"><link rel="prefetch" href="/rust-doc/assets/js/71.f92c7c1e.js"><link rel="prefetch" href="/rust-doc/assets/js/72.2a42f70d.js"><link rel="prefetch" href="/rust-doc/assets/js/73.4ca144e4.js"><link rel="prefetch" href="/rust-doc/assets/js/74.77c99bd3.js"><link rel="prefetch" href="/rust-doc/assets/js/75.cbea4ce4.js"><link rel="prefetch" href="/rust-doc/assets/js/76.ac99cadf.js"><link rel="prefetch" href="/rust-doc/assets/js/77.bf7e244c.js"><link rel="prefetch" href="/rust-doc/assets/js/78.7ed8a79d.js"><link rel="prefetch" href="/rust-doc/assets/js/79.f72f6b0b.js"><link rel="prefetch" href="/rust-doc/assets/js/80.f325b742.js"><link rel="prefetch" href="/rust-doc/assets/js/81.d1a8deff.js"><link rel="prefetch" href="/rust-doc/assets/js/82.77836ae8.js"><link rel="prefetch" href="/rust-doc/assets/js/83.546538e5.js"><link rel="prefetch" href="/rust-doc/assets/js/84.37731fb6.js"><link rel="prefetch" href="/rust-doc/assets/js/85.ed9491d3.js"><link rel="prefetch" href="/rust-doc/assets/js/86.4dbe057b.js"><link rel="prefetch" href="/rust-doc/assets/js/87.bc713bc5.js"><link rel="prefetch" href="/rust-doc/assets/js/88.c8a76430.js"><link rel="prefetch" href="/rust-doc/assets/js/89.0b495776.js"><link rel="prefetch" href="/rust-doc/assets/js/90.fa8ac1ee.js"><link rel="prefetch" href="/rust-doc/assets/js/91.f53a0013.js"><link rel="prefetch" href="/rust-doc/assets/js/92.50cc806e.js"><link rel="prefetch" href="/rust-doc/assets/js/93.5100619e.js"><link rel="prefetch" href="/rust-doc/assets/js/94.57884d29.js"><link rel="prefetch" href="/rust-doc/assets/js/95.d3724e70.js"><link rel="prefetch" href="/rust-doc/assets/js/96.53244e0d.js"><link rel="prefetch" href="/rust-doc/assets/js/97.65e3768f.js"><link rel="prefetch" href="/rust-doc/assets/js/98.b1dff7cc.js"><link rel="prefetch" href="/rust-doc/assets/js/99.3258dfbc.js"><link rel="prefetch" href="/rust-doc/assets/js/vendors~docsearch.3b28fe31.js">
    <link rel="stylesheet" href="/rust-doc/assets/css/0.styles.b04b0b2c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/rust-doc/" class="home-link router-link-active"><!----> <span class="site-name">rust语言中文文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/rust-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/eveningwater/rust-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/eveningwater" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/rust-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/eveningwater/rust-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/eveningwater" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/rust-doc/doc/introduce/introduce.html" class="sidebar-link">Rust介绍</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/getting-started/getting-started" class="sidebar-heading clickable"><span>入门</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/rust-doc/doc/guess-game/guess-game.html" class="sidebar-link">猜一猜游戏</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/common-concept/common-concept" class="sidebar-heading clickable"><span>常用的编程概念</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/understand-ownership/understand-ownership" class="sidebar-heading clickable"><span>认识所有权</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/structs/structs" class="sidebar-heading clickable"><span>使用结构体来构造相关数据</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/enums/enums" class="sidebar-heading clickable"><span>枚举</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/packages-crates-and-modules/packages-crates-and-modules" class="sidebar-heading clickable"><span>使用包、依赖箱和模块管理不断增长的项目</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/common-collections/common-collections" class="sidebar-heading clickable open"><span>常用集合</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/rust-doc/doc/common-collections/vectors.html" class="sidebar-link">使用向量存储值列表</a></li><li><a href="/rust-doc/doc/common-collections/strings.html" aria-current="page" class="active sidebar-link">使用字符串存储 UTF-8 编码的文本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rust-doc/doc/common-collections/strings.html#使用字符串存储-utf-8-编码的文本" class="sidebar-link">使用字符串存储 UTF-8 编码的文本</a></li></ul></li><li><a href="/rust-doc/doc/common-collections/hash-maps.html" class="sidebar-link">在哈希映射中存储键值对</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/error-handling/error-handling" class="sidebar-heading clickable"><span>错误处理</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/generics/generics" class="sidebar-heading clickable"><span>泛型类型、特性和生命周期</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/testing/testing" class="sidebar-heading clickable"><span>测试</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/an-io-project/an-io-project" class="sidebar-heading clickable"><span>I/O 项目：构建命令行程序</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/functional-features/functional-features" class="sidebar-heading clickable"><span>函数式语言特性：迭代器与闭包</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/more-about-cargo/more-about-cargo" class="sidebar-heading clickable"><span>关于 Cargo 和 Crates.io 的更多信息</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/smart-pointers/smart-pointers" class="sidebar-heading clickable"><span>智能指针</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/concurrency/concurrency" class="sidebar-heading clickable"><span>无畏并发</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/async-await/async-await" class="sidebar-heading clickable"><span>异步编程基础：Async、Await、Futures 和 Streams</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/oop/oop" class="sidebar-heading clickable"><span>面向对象编程特性</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/patterns/patterns" class="sidebar-heading clickable"><span>模式与匹配</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/advanced-features/advanced-features" class="sidebar-heading clickable"><span>高级特性</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>附录</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="使用字符串存储-utf-8-编码的文本"><a href="#使用字符串存储-utf-8-编码的文本" class="header-anchor">#</a> 使用字符串存储 UTF-8 编码的文本</h2> <p>我们在第 4 章中讨论过字符串，但现在我们将更深入地研究它们。
新 Rust 使用者通常会因为三个原因而在字符串上遇到困难：Rust 倾向于暴露可能的错误，字符串是比许多程序员认为的更复杂的数据结构，以及 UTF-8。这些因素结合在一起，当你从其他编程语言转过来时，可能会感到困难。</p> <p>我们在集合的上下文中讨论字符串，因为字符串是作为字节集合实现的，加上一些方法，当这些字节被解释为文本时提供有用的功能。在本节中，我们将讨论<code>String</code>拥有的每种集合类型都有的操作，例如创建、更新和读取。我们还将讨论<code>String</code>与其他集合不同的方式，即如何索引到<code>String</code>中因人与计算机解释<code>String</code>数据的差异而变得复杂。</p> <h3 id="什么是字符串"><a href="#什么是字符串" class="header-anchor">#</a> 什么是字符串？</h3> <p>我们首先定义我们所说的<em>字符串</em>是什么。Rust 在核心语言中只有一种字符串类型，即字符串切片<code>str</code>，通常以其借用形式<code>&amp;str</code>出现。在第 4 章中，我们讨论了<em>字符串切片</em>，它们是对存储在其他地方的一些 UTF-8 编码字符串数据的引用。例如，字符串字面值存储在程序的二进制文件中，因此它们是字符串切片。</p> <p><code>String</code>类型由 Rust 的标准库提供，而不是编码到核心语言中，它是一种可增长的、可变的、拥有所有权的、UTF-8 编码的字符串类型。当 Rustaceans 在 Rust 中提到&quot;字符串&quot;时，他们可能指的是<code>String</code>或字符串切片<code>&amp;str</code>类型，而不仅仅是其中一种类型。尽管本节主要讨论<code>String</code>，但这两种类型在 Rust 的标准库中都被大量使用，并且<code>String</code>和字符串切片都是 UTF-8 编码的。</p> <h3 id="创建新字符串"><a href="#创建新字符串" class="header-anchor">#</a> 创建新字符串</h3> <p><code>Vec&lt;T&gt;</code>可用的许多操作也可用于<code>String</code>，因为<code>String</code>实际上是作为带有一些额外保证、限制和功能的字节向量的包装器实现的。一个与<code>Vec&lt;T&gt;</code>和<code>String</code>工作方式相同的函数示例是<code>new</code>函数，用于创建实例，如示例 8-11 所示。</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例 8-11 创建一个新的空<code>String</code></p> <p>这行代码创建了一个名为<code>s</code>的新的空字符串，我们可以向其中加载数据。通常，我们会有一些初始数据，希望用它来开始字符串。为此，我们使用<code>to_string</code>方法，该方法可用于任何实现<code>Display</code>特性的类型，如字符串字面值。示例 8-12 展示了两个例子。</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&quot;initial contents&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> s <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// the method also works on a literal directly:</span>
    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">&quot;initial contents&quot;</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例 8-12 使用<code>to_string</code>方法从字符串字面值创建<code>String</code></p> <p>这段代码创建了一个包含<code>initial contents</code>的字符串。</p> <p>我们也可以使用函数<code>String::from</code>从字符串字面值创建<code>String</code>。示例 8-13 中的代码等同于使用<code>to_string</code>的示例 8-12 中的代码。</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;initial contents&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例 8-13 使用<code>String::from</code>函数从字符串字面值创建<code>String</code></p> <p>因为字符串用于很多事情，我们可以为字符串使用许多不同的通用 API，为我们提供了很多选择。其中一些可能看起来是多余的，但它们都有自己的位置！在这种情况下，<code>String::from</code>和<code>to_string</code>做同样的事情，所以选择哪一个是风格和可读性的问题。</p> <p>记住，字符串是 UTF-8 编码的，所以我们可以在其中包含任何正确编码的数据，如示例 8-14 所示。</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;السلام عليكم&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Dobrý den&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;שלום&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;नमस्ते&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;こんにちは&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;안녕하세요&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Olá&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Здравствуйте&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hola&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例 8-14 在字符串中存储不同语言的问候语</p> <p>所有这些都是有效的<code>String</code>值。</p> <h3 id="更新字符串"><a href="#更新字符串" class="header-anchor">#</a> 更新字符串</h3> <p><code>String</code>可以增长大小，其内容可以改变，就像<code>Vec&lt;T&gt;</code>的内容一样，如果你向其中推入更多数据。此外，你可以方便地使用<code>+</code>运算符或<code>format!</code>宏来连接<code>String</code>值。</p> <h4 id="使用push-str和push附加到字符串"><a href="#使用push-str和push附加到字符串" class="header-anchor">#</a> 使用<code>push_str</code>和<code>push</code>附加到字符串</h4> <p>我们可以使用<code>push_str</code>方法来增长<code>String</code>，附加一个字符串切片，如示例 8-15 所示。</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例 8-15 使用<code>push_str</code>方法将字符串切片附加到<code>String</code></p> <p>在这两行之后，<code>s</code>将包含<code>foobar</code>。<code>push_str</code>方法接受一个字符串切片，因为我们不一定想要获取参数的所有权。例如，在示例 8-16 的代码中，我们希望在将<code>s2</code>的内容附加到<code>s1</code>之后仍然能够使用<code>s2</code>。</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
    s1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s2 is {s2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例 8-16 在将字符串切片的内容附加到<code>String</code>后使用该字符串切片</p> <p>如果<code>push_str</code>方法获取了<code>s2</code>的所有权，我们就不能在最后一行打印其值。然而，这段代码按我们预期的方式工作！</p> <p><code>push</code>方法接受一个字符作为参数，并将其添加到<code>String</code>中。示例 8-17 使用<code>push</code>方法将字母<em>l</em>添加到<code>String</code>中。</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;lo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char">'l'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例 8-17 使用<code>push</code>向<code>String</code>值添加一个字符</p> <p>结果，<code>s</code>将包含<code>lol</code>。</p> <h4 id="使用-运算符或format-宏进行连接"><a href="#使用-运算符或format-宏进行连接" class="header-anchor">#</a> 使用<code>+</code>运算符或<code>format!</code>宏进行连接</h4> <p>通常，你会想要组合两个现有的字符串。一种方法是使用<code>+</code>运算符，如示例 8-18 所示。</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s3 <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token operator">&amp;</span>s2<span class="token punctuation">;</span> <span class="token comment">// 注意s1已经被移动，不能再使用</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例 8-18 使用<code>+</code>运算符将两个<code>String</code>值组合成一个新的<code>String</code>值</p> <p>字符串<code>s3</code>将包含<code>Hello, world!</code>。<code>s1</code>在加法之后不再有效，以及我们使用<code>s2</code>的引用的原因，与我们使用<code>+</code>运算符时调用的方法的签名有关。<code>+</code>运算符使用<code>add</code>方法，其签名看起来像这样：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token comment">// --snip--</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在标准库中，你会看到使用泛型和关联类型定义的<code>add</code>。这里，我们用具体类型替换，这是我们用<code>String</code>值调用此方法时发生的情况。我们将在第 10 章讨论泛型。这个签名给了我们理解<code>+</code>运算符棘手部分所需的线索。</p> <p>首先，<code>s2</code>有一个<code>&amp;</code>，意味着我们将第二个字符串的<em>引用</em>添加到第一个字符串。这是因为<code>add</code>函数中的<code>s</code>参数：我们只能将<code>&amp;str</code>添加到<code>String</code>；我们不能将两个<code>String</code>值相加。但等等——<code>&amp;s2</code>的类型是<code>&amp;String</code>，不是<code>&amp;str</code>，如<code>add</code>的第二个参数所指定的。那么为什么示例 8-18 能编译呢？</p> <p>我们能够在调用<code>add</code>时使用<code>&amp;s2</code>的原因是编译器可以将<code>&amp;String</code>参数<em>强制转换</em>为<code>&amp;str</code>。当我们调用<code>add</code>方法时，Rust 使用<em>解引用强制转换</em>，这里将<code>&amp;s2</code>变成<code>&amp;s2[..]</code>。我们将在第 15 章更深入地讨论解引用强制转换。因为<code>add</code>不获取<code>s</code>参数的所有权，<code>s2</code>在此操作后仍然是有效的<code>String</code>。</p> <p>其次，我们可以在签名中看到<code>add</code>获取<code>self</code>的所有权，因为<code>self</code><em>没有</em><code>&amp;</code>。这意味着示例 8-18 中的<code>s1</code>将被移动到<code>add</code>调用中，之后将不再有效。所以，尽管<code>let s3 = s1 + &amp;s2;</code>看起来像是会复制两个字符串并创建一个新的字符串，但这个语句实际上获取了<code>s1</code>的所有权，附加了<code>s2</code>内容的副本，然后返回结果的所有权。换句话说，它看起来像是在做很多复制，但实际上并没有；实现比复制更高效。</p> <p>如果我们需要连接多个字符串，<code>+</code>运算符的行为会变得笨拙：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tac&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;toe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> s <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> <span class="token operator">&amp;</span>s2 <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> <span class="token operator">&amp;</span>s3<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此时，<code>s</code>将是<code>tic-tac-toe</code>。随着所有的<code>+</code>和<code>&quot;</code>字符，很难看清发生了什么。对于更复杂的字符串组合，我们可以使用<code>format!</code>宏：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tac&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;toe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;{s1}-{s2}-{s3}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这段代码也将<code>s</code>设置为<code>tic-tac-toe</code>。<code>format!</code>宏的工作方式类似于<code>println!</code>，但不是将输出打印到屏幕，而是返回一个包含内容的<code>String</code>。使用<code>format!</code>的代码版本更容易阅读，并且<code>format!</code>宏生成的代码使用引用，所以这个调用不会获取任何参数的所有权。</p> <h3 id="索引到字符串"><a href="#索引到字符串" class="header-anchor">#</a> 索引到字符串</h3> <p>在许多其他编程语言中，通过索引引用字符串中的单个字符是有效且常见的操作。然而，如果你尝试在 Rust 中使用索引语法访问<code>String</code>的部分，你会得到一个错误。考虑示例 8-19 中的无效代码。</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> h <span class="token operator">=</span> s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例 8-19 尝试对 String 使用索引语法</p> <p>这段代码将导致以下错误：</p> <div class="language-console extra-class"><pre class="language-text"><code>$ cargo run
   Compiling collections v0.1.0 (file:///projects/collections)
error[E0277]: the type `str` cannot be indexed by `{integer}`
 --&gt; src/main.rs:3:16
  |
3 |     let h = s1[0];
  |                ^ string indices are ranges of `usize`
  |
  = help: the trait `SliceIndex&lt;str&gt;` is not implemented for `{integer}`, which is required by `String: Index&lt;_&gt;`
  = note: you can use `.chars().nth()` or `.bytes().nth()`
          for more information, see chapter 8 in The Book: &lt;https://doc.rust-lang.org/book/ch08-02-strings.html#indexing-into-strings&gt;
  = help: the trait `SliceIndex&lt;[_]&gt;` is implemented for `usize`
  = help: for that trait implementation, expected `[_]`, found `str`
  = note: required for `String` to implement `Index&lt;{integer}&gt;`

For more information about this error, try `rustc --explain E0277`.
error: could not compile `collections` (bin &quot;collections&quot;) due to 1 previous error
</code></pre></div><p>错误和注释讲述了故事：Rust 字符串不支持索引。但为什么不呢？要回答这个问题，我们需要讨论 Rust 如何在内存中存储字符串。</p> <h4 id="内部表示"><a href="#内部表示" class="header-anchor">#</a> 内部表示</h4> <p><code>String</code>是<code>Vec&lt;u8&gt;</code>的包装器。让我们看看示例 8-14 中一些正确编码的 UTF-8 示例字符串。首先，这个：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;السلام عليكم&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Dobrý den&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;שלום&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;नमस्ते&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;こんにちは&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;안녕하세요&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Olá&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Здравствуйте&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hola&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这种情况下，<code>len</code>将是<code>4</code>，这意味着存储字符串<code>&quot;Hola&quot;</code>的向量长度为 4 个字节。这些字母中的每一个在 UTF-8 编码中都占用一个字节。然而，下面这行可能会让你感到惊讶（注意这个字符串以大写的西里尔字母<em>Ze</em>开头，而不是数字 3）：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;السلام عليكم&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Dobrý den&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;שלום&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;नमस्ते&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;こんにちは&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;안녕하세요&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Olá&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Здравствуйте&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hola&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果有人问你这个字符串有多长，你可能会说 12。事实上，Rust 的答案是 24：这是在 UTF-8 中编码&quot;Здравствуйте&quot;所需的字节数，因为该字符串中的每个 Unicode 标量值占用 2 个字节的存储空间。因此，字符串字节的索引并不总是与有效的 Unicode 标量值相关。为了演示，考虑这个无效的 Rust 代码：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token string">&quot;Здравствуйте&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> answer <span class="token operator">=</span> <span class="token operator">&amp;</span>hello<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>你已经知道<code>answer</code>不会是<code>З</code>，即第一个字母。当在 UTF-8 中编码时，<code>З</code>的第一个字节是<code>208</code>，第二个是<code>151</code>，所以看起来<code>answer</code>实际上应该是<code>208</code>，但<code>208</code>本身不是一个有效的字符。返回<code>208</code>可能不是用户在请求这个字符串的第一个字母时想要的；然而，这是 Rust 在字节索引 0 处唯一拥有的数据。用户通常不希望返回字节值，即使字符串只包含拉丁字母：如果<code>&amp;&quot;hi&quot;[0]</code>是有效的代码并返回字节值，它将返回<code>104</code>，而不是<code>h</code>。</p> <p>因此，答案是，为了避免返回意外值并导致可能不会立即被发现的错误，Rust 根本不编译这段代码，并在开发过程的早期防止误解。</p> <h4 id="字节、标量值和字形簇-天啊"><a href="#字节、标量值和字形簇-天啊" class="header-anchor">#</a> 字节、标量值和字形簇！天啊！</h4> <p>关于 UTF-8 的另一点是，从 Rust 的角度看，实际上有三种相关的方式来看待字符串：作为字节、标量值和字形簇（最接近我们所说的<em>字母</em>的东西）。</p> <p>如果我们看用梵文写的印地语单词&quot;नमस्ते&quot;，它存储为<code>u8</code>值的向量，看起来像这样：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span>
<span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">]</span>
</code></pre></div><p>这是 18 个字节，计算机最终就是这样存储这些数据的。如果我们将它们看作 Unicode 标量值，即 Rust 的<code>char</code>类型，那些字节看起来像这样：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token char">'न'</span><span class="token punctuation">,</span> <span class="token char">'म'</span><span class="token punctuation">,</span> <span class="token char">'स'</span><span class="token punctuation">,</span> <span class="token char">'्'</span><span class="token punctuation">,</span> <span class="token char">'त'</span><span class="token punctuation">,</span> <span class="token char">'े'</span><span class="token punctuation">]</span>
</code></pre></div><p>这里有六个<code>char</code>值，但第四个和第六个不是字母：它们是单独没有意义的变音符号。最后，如果我们将它们看作字形簇，我们会得到一个人所说的组成印地语单词的四个字母：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span><span class="token string">&quot;न&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;म&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;स्&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ते&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>Rust 提供了不同的方式来解释计算机存储的原始字符串数据，这样每个程序都可以选择它需要的解释，无论数据是什么人类语言。</p> <p>Rust 不允许我们索引到<code>String</code>以获取字符的最后一个原因是，索引操作预期总是花费常量时间（O(1)）。但对于<code>String</code>，无法保证这种性能，因为 Rust 必须从头遍历内容到索引，以确定有多少有效字符。</p> <h3 id="切片字符串"><a href="#切片字符串" class="header-anchor">#</a> 切片字符串</h3> <p>索引到字符串通常是个坏主意，因为不清楚字符串索引操作的返回类型应该是什么：字节值、字符、字形簇或字符串切片。因此，如果你真的需要使用索引来创建字符串切片，Rust 要求你更加明确。</p> <p>与其使用<code>[]</code>和单个数字进行索引，你可以使用<code>[]</code>和一个范围来创建包含特定字节的字符串切片：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token string">&quot;Здравствуйте&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token operator">&amp;</span>hello<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>这里，<code>s</code>将是一个<code>&amp;str</code>，包含字符串的前四个字节。前面我们提到，这些字符中的每一个是两个字节，这意味着<code>s</code>将是<code>Зд</code>。</p> <p>如果我们尝试只切片一个字符的部分字节，比如<code>&amp;hello[0..1]</code>，Rust 会在运行时恐慌，就像访问向量中的无效索引一样：</p> <div class="language-rust extra-class"><pre class="language-rust"><code>$ cargo run
   <span class="token class-name">Compiling</span> collections v0<span class="token number">.1</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token punctuation">(</span>file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token comment">//projects/collections)</span>
    <span class="token class-name">Finished</span> `dev` profile <span class="token punctuation">[</span>unoptimized <span class="token operator">+</span> debuginfo<span class="token punctuation">]</span> <span class="token function">target</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">.</span>43s
     <span class="token class-name">Running</span> `target<span class="token operator">/</span>debug<span class="token operator">/</span>collections`
thread <span class="token lifetime-annotation symbol">'main</span>' panicked at src<span class="token operator">/</span>main<span class="token punctuation">.</span>rs<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span>
byte index <span class="token number">1</span> is not a <span class="token keyword">char</span> boundary<span class="token punctuation">;</span> it is inside <span class="token char">'З'</span> <span class="token punctuation">(</span>bytes <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span> of `Здравствуйте`
note<span class="token punctuation">:</span> run with `<span class="token constant">RUST_BACKTRACE</span><span class="token operator">=</span><span class="token number">1</span>` environment variable to display a backtrace
</code></pre></div><p>在使用范围创建字符串切片时应该小心，因为这样做可能会使你的程序崩溃。</p> <h3 id="迭代字符串的方法"><a href="#迭代字符串的方法" class="header-anchor">#</a> 迭代字符串的方法</h3> <p>操作字符串片段的最佳方式是明确你是想要字符还是字节。对于单个 Unicode 标量值，使用<code>chars</code>方法。在&quot;Зд&quot;上调用<code>chars</code>会分离出并返回两个<code>char</code>类型的值，你可以迭代结果来访问每个元素：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">&quot;Зд&quot;</span><span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{c}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这段代码将打印以下内容：</p> <div class="language-rust extra-class"><pre class="language-rust"><code>З
д
</code></pre></div><p>或者，<code>bytes</code>方法返回每个原始字节，这可能适合你的领域：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token string">&quot;Зд&quot;</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{b}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这段代码将打印组成这个字符串的四个字节：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token number">208</span>
<span class="token number">151</span>
<span class="token number">208</span>
<span class="token number">180</span>
</code></pre></div><p>但请记住，有效的 Unicode 标量值可能由多个字节组成。</p> <p>从字符串获取字形簇，如梵文脚本，是复杂的，所以标准库没有提供这个功能。如果你需要这个功能，可以在<a href="https://crates.io/" target="_blank" rel="noopener noreferrer">crates.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上找到相关的 crate。</p> <h3 id="字符串并不那么简单"><a href="#字符串并不那么简单" class="header-anchor">#</a> 字符串并不那么简单</h3> <p>总结一下，字符串很复杂。不同的编程语言对如何向程序员呈现这种复杂性做出不同的选择。Rust 选择将正确处理<code>String</code>数据作为所有 Rust 程序的默认行为，这意味着程序员必须预先更多地考虑处理 UTF-8 数据。这种权衡暴露了比其他编程语言中明显的更多的字符串复杂性，但它防止你在开发生命周期的后期处理涉及非 ASCII 字符的错误。</p> <p>好消息是，标准库提供了许多基于<code>String</code>和<code>&amp;str</code>类型的功能，帮助正确处理这些复杂情况。请务必查看文档中有用的方法，如用于在字符串中搜索的<code>contains</code>和用于替换字符串部分的<code>replace</code>。</p> <p>让我们转向一些不那么复杂的东西：哈希映射！</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/rust-doc/doc/common-collections/vectors.html" class="prev">
        使用向量存储值列表
      </a></span> <span class="next"><a href="/rust-doc/doc/common-collections/hash-maps.html">
        在哈希映射中存储键值对
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/rust-doc/assets/js/app.5c13fa7e.js" defer></script><script src="/rust-doc/assets/js/2.de3bffe6.js" defer></script><script src="/rust-doc/assets/js/1.5cc4c8d6.js" defer></script><script src="/rust-doc/assets/js/61.177a1122.js" defer></script>
  </body>
</html>
