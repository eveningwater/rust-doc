<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用Send和Sync特性的可扩展并发 | rust语言中文文档</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/rust-doc/logo.svg">
    <script type="text/javascript" src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>
    <meta name="description" content="一门赋予每个人构建可靠且高效软件能力的语言。">
    
    <link rel="preload" href="/rust-doc/assets/css/0.styles.b04b0b2c.css" as="style"><link rel="preload" href="/rust-doc/assets/js/app.f0d374f6.js" as="script"><link rel="preload" href="/rust-doc/assets/js/2.f80c1e3f.js" as="script"><link rel="preload" href="/rust-doc/assets/js/1.fd67daac.js" as="script"><link rel="preload" href="/rust-doc/assets/js/73.16e1c3d6.js" as="script"><link rel="prefetch" href="/rust-doc/assets/js/10.eb17c9b1.js"><link rel="prefetch" href="/rust-doc/assets/js/100.fefafa9b.js"><link rel="prefetch" href="/rust-doc/assets/js/101.17ee2c97.js"><link rel="prefetch" href="/rust-doc/assets/js/102.348689f8.js"><link rel="prefetch" href="/rust-doc/assets/js/103.b1fc7e8c.js"><link rel="prefetch" href="/rust-doc/assets/js/104.3183edc5.js"><link rel="prefetch" href="/rust-doc/assets/js/105.a6cc6f0f.js"><link rel="prefetch" href="/rust-doc/assets/js/106.ffb0a0de.js"><link rel="prefetch" href="/rust-doc/assets/js/107.0ce758b4.js"><link rel="prefetch" href="/rust-doc/assets/js/108.1da873f8.js"><link rel="prefetch" href="/rust-doc/assets/js/109.d28576a3.js"><link rel="prefetch" href="/rust-doc/assets/js/11.4d96857f.js"><link rel="prefetch" href="/rust-doc/assets/js/110.714de49b.js"><link rel="prefetch" href="/rust-doc/assets/js/111.f34ee52d.js"><link rel="prefetch" href="/rust-doc/assets/js/112.150389e0.js"><link rel="prefetch" href="/rust-doc/assets/js/113.c600da56.js"><link rel="prefetch" href="/rust-doc/assets/js/114.8dd55411.js"><link rel="prefetch" href="/rust-doc/assets/js/115.d81d1edd.js"><link rel="prefetch" href="/rust-doc/assets/js/116.589a38c1.js"><link rel="prefetch" href="/rust-doc/assets/js/117.df8467d8.js"><link rel="prefetch" href="/rust-doc/assets/js/118.c981eed9.js"><link rel="prefetch" href="/rust-doc/assets/js/119.82c7f0ad.js"><link rel="prefetch" href="/rust-doc/assets/js/12.0eea138a.js"><link rel="prefetch" href="/rust-doc/assets/js/120.f0a989fe.js"><link rel="prefetch" href="/rust-doc/assets/js/121.5b3a830f.js"><link rel="prefetch" href="/rust-doc/assets/js/122.36b7633b.js"><link rel="prefetch" href="/rust-doc/assets/js/123.cb56d684.js"><link rel="prefetch" href="/rust-doc/assets/js/124.4a94c2a7.js"><link rel="prefetch" href="/rust-doc/assets/js/125.2da7eeab.js"><link rel="prefetch" href="/rust-doc/assets/js/126.c8929e44.js"><link rel="prefetch" href="/rust-doc/assets/js/127.8fb0f7a0.js"><link rel="prefetch" href="/rust-doc/assets/js/128.dd80d591.js"><link rel="prefetch" href="/rust-doc/assets/js/129.aa170fe9.js"><link rel="prefetch" href="/rust-doc/assets/js/13.4e4de3f9.js"><link rel="prefetch" href="/rust-doc/assets/js/130.db8c6071.js"><link rel="prefetch" href="/rust-doc/assets/js/131.93d3925a.js"><link rel="prefetch" href="/rust-doc/assets/js/14.7d8cc8c4.js"><link rel="prefetch" href="/rust-doc/assets/js/15.c72c8a9e.js"><link rel="prefetch" href="/rust-doc/assets/js/16.d49862cf.js"><link rel="prefetch" href="/rust-doc/assets/js/17.c084fb46.js"><link rel="prefetch" href="/rust-doc/assets/js/18.61b146cc.js"><link rel="prefetch" href="/rust-doc/assets/js/19.ac65ddaa.js"><link rel="prefetch" href="/rust-doc/assets/js/20.b2f37783.js"><link rel="prefetch" href="/rust-doc/assets/js/21.bc7abb0d.js"><link rel="prefetch" href="/rust-doc/assets/js/22.2dd10b21.js"><link rel="prefetch" href="/rust-doc/assets/js/23.55de02b6.js"><link rel="prefetch" href="/rust-doc/assets/js/24.3123e7b2.js"><link rel="prefetch" href="/rust-doc/assets/js/25.c2d4d2c7.js"><link rel="prefetch" href="/rust-doc/assets/js/26.7cf20f6f.js"><link rel="prefetch" href="/rust-doc/assets/js/27.b6484f43.js"><link rel="prefetch" href="/rust-doc/assets/js/28.a022eff5.js"><link rel="prefetch" href="/rust-doc/assets/js/29.7b185968.js"><link rel="prefetch" href="/rust-doc/assets/js/3.bfcba754.js"><link rel="prefetch" href="/rust-doc/assets/js/30.4186c23c.js"><link rel="prefetch" href="/rust-doc/assets/js/31.813b9678.js"><link rel="prefetch" href="/rust-doc/assets/js/32.44491046.js"><link rel="prefetch" href="/rust-doc/assets/js/33.52d1bd4d.js"><link rel="prefetch" href="/rust-doc/assets/js/34.322d9308.js"><link rel="prefetch" href="/rust-doc/assets/js/35.ca435b08.js"><link rel="prefetch" href="/rust-doc/assets/js/36.c5e7b3e2.js"><link rel="prefetch" href="/rust-doc/assets/js/37.4b0c4e3a.js"><link rel="prefetch" href="/rust-doc/assets/js/38.176b7420.js"><link rel="prefetch" href="/rust-doc/assets/js/39.ac4964b1.js"><link rel="prefetch" href="/rust-doc/assets/js/4.0d286bf5.js"><link rel="prefetch" href="/rust-doc/assets/js/40.b5016b37.js"><link rel="prefetch" href="/rust-doc/assets/js/41.c051920d.js"><link rel="prefetch" href="/rust-doc/assets/js/42.b1e880d5.js"><link rel="prefetch" href="/rust-doc/assets/js/43.4061a648.js"><link rel="prefetch" href="/rust-doc/assets/js/44.b6ce63a6.js"><link rel="prefetch" href="/rust-doc/assets/js/45.778e0931.js"><link rel="prefetch" href="/rust-doc/assets/js/46.75468c64.js"><link rel="prefetch" href="/rust-doc/assets/js/47.2c1e1a10.js"><link rel="prefetch" href="/rust-doc/assets/js/48.35f9f3e6.js"><link rel="prefetch" href="/rust-doc/assets/js/49.1ee52dfa.js"><link rel="prefetch" href="/rust-doc/assets/js/5.1658b7c6.js"><link rel="prefetch" href="/rust-doc/assets/js/50.2ad6c5d5.js"><link rel="prefetch" href="/rust-doc/assets/js/51.18a069ec.js"><link rel="prefetch" href="/rust-doc/assets/js/52.59cb67e0.js"><link rel="prefetch" href="/rust-doc/assets/js/53.0d9d34de.js"><link rel="prefetch" href="/rust-doc/assets/js/54.0a9fe69b.js"><link rel="prefetch" href="/rust-doc/assets/js/55.a30e4a64.js"><link rel="prefetch" href="/rust-doc/assets/js/56.5df943c5.js"><link rel="prefetch" href="/rust-doc/assets/js/57.f44ee57f.js"><link rel="prefetch" href="/rust-doc/assets/js/58.34af13bf.js"><link rel="prefetch" href="/rust-doc/assets/js/59.dab934fe.js"><link rel="prefetch" href="/rust-doc/assets/js/6.6bd8219b.js"><link rel="prefetch" href="/rust-doc/assets/js/60.5b5aefde.js"><link rel="prefetch" href="/rust-doc/assets/js/61.cc30625c.js"><link rel="prefetch" href="/rust-doc/assets/js/62.57791b4d.js"><link rel="prefetch" href="/rust-doc/assets/js/63.d10762f6.js"><link rel="prefetch" href="/rust-doc/assets/js/64.dc64731f.js"><link rel="prefetch" href="/rust-doc/assets/js/65.4ee2306c.js"><link rel="prefetch" href="/rust-doc/assets/js/66.f1a99e1f.js"><link rel="prefetch" href="/rust-doc/assets/js/67.6903a840.js"><link rel="prefetch" href="/rust-doc/assets/js/68.efc3417d.js"><link rel="prefetch" href="/rust-doc/assets/js/69.4c361eff.js"><link rel="prefetch" href="/rust-doc/assets/js/7.76c11fc1.js"><link rel="prefetch" href="/rust-doc/assets/js/70.5f433f05.js"><link rel="prefetch" href="/rust-doc/assets/js/71.e7030c67.js"><link rel="prefetch" href="/rust-doc/assets/js/72.cc994ed8.js"><link rel="prefetch" href="/rust-doc/assets/js/74.8dde486e.js"><link rel="prefetch" href="/rust-doc/assets/js/75.00a1c9ed.js"><link rel="prefetch" href="/rust-doc/assets/js/76.7b27ad89.js"><link rel="prefetch" href="/rust-doc/assets/js/77.537c5d96.js"><link rel="prefetch" href="/rust-doc/assets/js/78.d5ec6a76.js"><link rel="prefetch" href="/rust-doc/assets/js/79.485d89fb.js"><link rel="prefetch" href="/rust-doc/assets/js/80.49855892.js"><link rel="prefetch" href="/rust-doc/assets/js/81.ebe811b5.js"><link rel="prefetch" href="/rust-doc/assets/js/82.35ef98d5.js"><link rel="prefetch" href="/rust-doc/assets/js/83.442f1239.js"><link rel="prefetch" href="/rust-doc/assets/js/84.a2c5694c.js"><link rel="prefetch" href="/rust-doc/assets/js/85.186197b8.js"><link rel="prefetch" href="/rust-doc/assets/js/86.1ce0ee03.js"><link rel="prefetch" href="/rust-doc/assets/js/87.16afe7d6.js"><link rel="prefetch" href="/rust-doc/assets/js/88.38fc6f23.js"><link rel="prefetch" href="/rust-doc/assets/js/89.7e4e8cf3.js"><link rel="prefetch" href="/rust-doc/assets/js/90.9a764995.js"><link rel="prefetch" href="/rust-doc/assets/js/91.59e310ba.js"><link rel="prefetch" href="/rust-doc/assets/js/92.bf258199.js"><link rel="prefetch" href="/rust-doc/assets/js/93.bbef4287.js"><link rel="prefetch" href="/rust-doc/assets/js/94.1aeb268a.js"><link rel="prefetch" href="/rust-doc/assets/js/95.d20aa01a.js"><link rel="prefetch" href="/rust-doc/assets/js/96.1c2ac11b.js"><link rel="prefetch" href="/rust-doc/assets/js/97.f8400bd1.js"><link rel="prefetch" href="/rust-doc/assets/js/98.8cb332e9.js"><link rel="prefetch" href="/rust-doc/assets/js/99.3cf0cdd5.js"><link rel="prefetch" href="/rust-doc/assets/js/vendors~docsearch.5da1c945.js">
    <link rel="stylesheet" href="/rust-doc/assets/css/0.styles.b04b0b2c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/rust-doc/" class="home-link router-link-active"><!----> <span class="site-name">rust语言中文文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/rust-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/eveningwater/rust-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/eveningwater" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/rust-doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/eveningwater/rust-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/eveningwater" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/rust-doc/doc/introduce/introduce.html" class="sidebar-link">Rust介绍</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/getting-started/getting-started" class="sidebar-heading clickable"><span>入门</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/rust-doc/doc/guess-game/guess-game.html" class="sidebar-link">猜一猜游戏</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/common-concept/common-concept" class="sidebar-heading clickable"><span>常用的编程概念</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/understand-ownership/understand-ownership" class="sidebar-heading clickable"><span>认识所有权</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/structs/structs" class="sidebar-heading clickable"><span>使用结构体来构造相关数据</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/enums/enums" class="sidebar-heading clickable"><span>枚举</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/packages-crates-and-modules/packages-crates-and-modules" class="sidebar-heading clickable"><span>使用包、依赖箱和模块管理不断增长的项目</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/common-collections/common-collections" class="sidebar-heading clickable"><span>常用集合</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/error-handling/error-handling" class="sidebar-heading clickable"><span>错误处理</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/generics/generics" class="sidebar-heading clickable"><span>泛型类型、特性和生命周期</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/testing/testing" class="sidebar-heading clickable"><span>测试</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/an-io-project/an-io-project" class="sidebar-heading clickable"><span>I/O 项目：构建命令行程序</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/functional-features/functional-features" class="sidebar-heading clickable"><span>函数式语言特性：迭代器与闭包</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/more-about-cargo/more-about-cargo" class="sidebar-heading clickable"><span>关于 Cargo 和 Crates.io 的更多信息</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/smart-pointers/smart-pointers" class="sidebar-heading clickable"><span>智能指针</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/concurrency/concurrency" class="sidebar-heading clickable open"><span>无畏并发</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/rust-doc/doc/concurrency/threads.html" class="sidebar-link">使用线程同时运行代码</a></li><li><a href="/rust-doc/doc/concurrency/message-passing.html" class="sidebar-link">使用消息传递在线程间传递数据</a></li><li><a href="/rust-doc/doc/concurrency/shared-state.html" class="sidebar-link">共享状态并发</a></li><li><a href="/rust-doc/doc/concurrency/extensible-concurrency-sync-and-send.html" aria-current="page" class="active sidebar-link">使用`Send`和`Sync`特性的可扩展并发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rust-doc/doc/concurrency/extensible-concurrency-sync-and-send.html#使用send和sync特性的可扩展并发" class="sidebar-link">使用Send和Sync特性的可扩展并发</a></li><li class="sidebar-sub-header"><a href="/rust-doc/doc/concurrency/extensible-concurrency-sync-and-send.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/async-await/async-await" class="sidebar-heading clickable"><span>异步编程基础：Async、Await、Futures 和 Streams</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/oop/oop" class="sidebar-heading clickable"><span>面向对象编程特性</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/patterns/patterns" class="sidebar-heading clickable"><span>模式与匹配</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/advanced-features/advanced-features" class="sidebar-heading clickable"><span>高级特性</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rust-doc/doc/final-project/final-project" class="sidebar-heading clickable"><span>最终项目：构建多线程Web服务器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>附录</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="使用send和sync特性的可扩展并发"><a href="#使用send和sync特性的可扩展并发" class="header-anchor">#</a> 使用<code>Send</code>和<code>Sync</code>特性的可扩展并发</h2> <p>有趣的是，到目前为止我们在本章中讨论的几乎所有并发特性都是标准库的一部分，而不是语言本身的一部分。处理并发的选项不仅限于语言或标准库；你可以编写自己的并发特性或使用其他人编写的并发特性。</p> <p>然而，嵌入在语言中而不是标准库中的关键并发概念之一是<code>std::marker</code>特性<code>Send</code>和<code>Sync</code>。</p> <h3 id="使用send允许线程间所有权转移"><a href="#使用send允许线程间所有权转移" class="header-anchor">#</a> 使用<code>Send</code>允许线程间所有权转移</h3> <p><code>Send</code>标记特性表示实现<code>Send</code>的类型的值的所有权可以在线程之间转移。几乎所有的Rust类型都是Send，但也有一些例外，包括<code>Rc&lt;T&gt;</code>：它不能实现<code>Send</code>，因为如果你克隆了一个<code>Rc&lt;T&gt;</code>值并尝试将克隆的所有权转移到另一个线程，两个线程可能会同时更新引用计数。因此，<code>Rc&lt;T&gt;</code>被实现为在单线程情况下使用，在这种情况下你不想付出线程安全的性能代价。</p> <p>因此，Rust的类型系统和特性约束确保你永远不会意外地不安全地跨线程发送<code>Rc&lt;T&gt;</code>值。当我们在示例16-14中尝试这样做时，我们得到了<code>the error the trait Send is not implemented for <code>Rc&lt;Mutex&lt;i32&gt;&gt;</code></code>的错误。当我们切换到实现了<code>Send</code>的<code>Arc&lt;T&gt;</code>时，代码编译通过了。</p> <p>完全由<code>Send</code>类型组成的任何类型也会自动标记为<code>Send</code>。几乎所有的原始类型都是<code>Send</code>，除了原始指针，我们将在第20章中讨论。</p> <h3 id="使用sync允许多线程访问"><a href="#使用sync允许多线程访问" class="header-anchor">#</a> 使用<code>Sync</code>允许多线程访问</h3> <p><code>Sync</code>标记特性表示实现<code>Sync</code>的类型可以安全地从多个线程引用。换句话说，任何类型<code>T</code>如果<code>&amp;T</code>（对<code>T</code>的不可变引用）实现了<code>Send</code>，那么它就实现了<code>Sync</code>，这意味着引用可以安全地发送到另一个线程。与<code>Send</code>类似，所有原始类型都实现了<code>Sync</code>，完全由实现<code>Sync</code>的类型组成的类型也实现了<code>Sync</code>。</p> <p>智能指针<code>Rc&lt;T&gt;</code>也不实现<code>Sync</code>，原因与它不实现<code>Send</code>相同。<code>RefCell&lt;T&gt;</code>类型（我们在第15章中讨论过）和相关的<code>Cell&lt;T&gt;</code>类型家族不实现<code>Sync</code>。<code>RefCell&lt;T&gt;</code>在运行时进行的借用检查实现不是线程安全的。智能指针<code>Mutex&lt;T&gt;</code>实现了<code>Sync</code>，可以用于在多个线程之间共享访问，正如你在<a href="https://doc.rust-lang.org/book/ch16-03-shared-state.html#sharing-a-mutext-between-multiple-threads" target="_blank" rel="noopener noreferrer">&quot;在多个线程之间共享Mutex<T>&quot;<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></T></a>中看到的那样。</p> <h3 id="手动实现send和sync是不安全的"><a href="#手动实现send和sync是不安全的" class="header-anchor">#</a> 手动实现<code>Send</code>和<code>Sync</code>是不安全的</h3> <p>因为完全由实现<code>Send</code>和<code>Sync</code>特性的其他类型组成的类型也会自动实现<code>Send</code>和<code>Sync</code>，所以我们不必手动实现这些特性。作为标记特性，它们甚至没有任何方法需要实现。它们只是对于强制执行与并发相关的不变量很有用。</p> <p>手动实现这些特性涉及实现不安全的Rust代码。我们将在第20章中讨论使用不安全的Rust代码；现在，重要的信息是构建不由<code>Send</code>和<code>Sync</code>部分组成的新并发类型需要仔细思考以维护安全保证。<a href="https://doc.rust-lang.org/nomicon/index.html" target="_blank" rel="noopener noreferrer">&quot;The Rustonomicon&quot;<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>有关于这些保证以及如何维护它们的更多信息。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>这不是你在本文档中最后一次看到并发：下一章重点讨论异步编程，第21章中的项目将在比这里讨论的小例子更现实的情况下使用本章中的概念。</p> <p>如前所述，因为Rust处理并发的方式很少是语言的一部分，所以许多并发解决方案都是作为crate实现的。这些比标准库发展得更快，所以一定要在网上搜索当前最先进的crate，以便在多线程情况下使用。</p> <p>Rust标准库提供了用于消息传递的通道和智能指针类型，如<code>Mutex&lt;T&gt;</code>和<code>Arc&lt;T&gt;</code>，它们可以安全地用于并发上下文。类型系统和借用检查器确保使用这些解决方案的代码不会最终出现数据竞争或无效引用。一旦你的代码编译通过，你可以放心，它将愉快地在多个线程上运行，而不会出现其他语言中常见的难以追踪的错误。并发编程不再是一个令人恐惧的概念：勇往直前，无所畏惧地让你的程序并发吧！</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/rust-doc/doc/concurrency/shared-state.html" class="prev">
        共享状态并发
      </a></span> <span class="next"><a href="/rust-doc/doc/async-await/futures-and-syntax.html">
        Future 与异步语法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/rust-doc/assets/js/app.f0d374f6.js" defer></script><script src="/rust-doc/assets/js/2.f80c1e3f.js" defer></script><script src="/rust-doc/assets/js/1.fd67daac.js" defer></script><script src="/rust-doc/assets/js/73.16e1c3d6.js" defer></script>
  </body>
</html>
